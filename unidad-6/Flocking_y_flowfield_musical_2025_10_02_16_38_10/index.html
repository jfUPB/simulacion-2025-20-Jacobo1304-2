<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Boids · FlowField · FFT Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --ui-bg: rgba(6,10,18,0.75); --accent: #7fd3ff; --muted: #cbd5e1; }
    html,body { height:100%; margin:0; background:#071018; color:#e6eef6; font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif; -webkit-font-smoothing:antialiased; }
    #ui {
      position:fixed;
      left:8px;
      top:8px;
      z-index:1000;
      display:flex;
      gap:8px;
      align-items:center;
      padding:8px;
      border-radius:8px;
      background:var(--ui-bg);
      backdrop-filter: blur(6px);
      flex-wrap:wrap;
      max-width: calc(100% - 16px);
    }
    #ui > * { color:var(--muted); font-size:13px; }
    .btn { background:transparent; border:1px solid rgba(255,255,255,0.06); padding:6px 8px; border-radius:6px; cursor:pointer; color:var(--muted); }
    .btn.primary { background:linear-gradient(90deg,#0ea5c9,#7dd3fc); color:#022; border:none; font-weight:600; }
    input[type="range"] { width:120px; }
    input[type="file"] { color:var(--muted); }
    label { font-size:12px; margin-right:4px; color:#cfe9ff; }
    #status { margin-left:6px; font-size:13px; color:#dbeafe; }
    #right-controls { margin-left:auto; display:flex; gap:8px; align-items:center; }
    @media (max-width:640px) {
      #ui { padding:6px; gap:6px; font-size:12px; }
      input[type="range"] { width:100px; }
    }
    canvas { display:block; } /* p5 canvas fills the rest */
  </style>
</head>
<body>
  <div id="ui" role="toolbar" aria-label="Controles">
    <!-- Left group -->
    <input id="fileinput" type="file" accept="audio/*">
    <button id="playbtn" class="btn">Play / Pause</button>

    <label for="vol">Vol</label>
    <input id="vol" type="range" min="0" max="1" step="0.01" value="0.6">

    <label for="res">Grid</label>
    <input id="res" type="range" min="8" max="60" step="1" value="25">

    <label for="burstSize" title="Tamaño de la ráfaga (Q/E)">Burst</label>
    <input id="burstSize" type="number" min="1" max="500" step="1" value="40" style="width:64px">

    <button id="preset1" class="btn">Preset 1</button>
    <button id="preset2" class="btn">Preset 2</button>
    <button id="preset3" class="btn">Preset 3</button>

    <div id="right-controls">
      <button id="fullscreenBtn" class="btn">Pantalla completa</button>
      <button id="toggleField" class="btn">Mostrar Field</button>
      <span id="status">Sin audio cargado.</span>
    </div>
  </div>

  <!-- p5 + p5.sound -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/addons/p5.sound.min.js"></script>

  <!-- Tu sketch (sketch.js) -->
   <script src="FlowField.js"></script>
   <script src="boid.js"></script>
   <script src="flock.js"></script>
  <script src="sketch.js"></script>

  <script>
    // pequeños enlaces UI <-> sketch variables (seguro si sketch define las IDs ya usadas)
    window.addEventListener('load', () => {
      const burstEl = document.getElementById('burstSize');
      const preset1 = document.getElementById('preset1');
      const preset2 = document.getElementById('preset2');
      const preset3 = document.getElementById('preset3');
      const toggleField = document.getElementById('toggleField');

    burstEl.addEventListener('input', () => {
  if (typeof burstSizeManual !== 'undefined') burstSizeManual = Math.max(1, parseInt(burstEl.value) || 1);
});

      // Preset buttons
      preset1.addEventListener('click', () => { if (typeof applyPreset === 'function') applyPreset(1); });
      preset2.addEventListener('click', () => { if (typeof applyPreset === 'function') applyPreset(2); });
      preset3.addEventListener('click', () => { if (typeof applyPreset === 'function') applyPreset(3); });

      // Toggle showField quick button (mirror F)
      toggleField.addEventListener('click', () => {
        if (typeof showField !== 'undefined') {
          showField = !showField;
          toggleField.textContent = showField ? 'Ocultar Field' : 'Mostrar Field';
        }
      });

      // Wire play button (in case sketch didn't)
      const playBtn = document.getElementById('playbtn');
      playBtn.addEventListener('click', () => {
        if (typeof togglePlay === 'function') togglePlay();
      });

      // Wire file input (the sketch also wires it, this is just UX safety)
      const fileInput = document.getElementById('fileinput');
      fileInput.addEventListener('change', (e) => {
        if (typeof handleFileInput === 'function') handleFileInput(e);
      });

      // fullscreen quick access (also in sketch)
      const fsBtn = document.getElementById('fullscreenBtn');
      fsBtn.addEventListener('click', () => {
        if (typeof toggleFullscreen === 'function') toggleFullscreen();
        else if (typeof fullscreen === 'function') fullscreen(!fullscreen());
      });

      // reflect initial toggleField label
      toggleField.textContent = (typeof showField !== 'undefined' && showField) ? 'Ocultar Field' : 'Mostrar Field';
    });
  </script>
</body>
</html>
